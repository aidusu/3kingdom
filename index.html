<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跨裝置GPS點位標註系統</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        #map { height: 70vh; width: 100%; }
        .input-group { margin: 10px 0; display: flex; gap: 10px; flex-wrap: wrap; }
        input[type="text"] { padding: 8px; flex: 1; min-width: 200px; }
        button { padding: 8px 16px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        #marker-list { margin-top: 20px; padding: 0; list-style: none; }
        #marker-list li { padding: 5px; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>
    <h2>GPS點位標註系統</h2>
    <div class="input-group">
    <input type="text" id="lat" placeholder="緯度 (例：25.033968)" pattern="-?\d+\.?\d*">
    <input type="text" id="lng" placeholder="經度 (例：121.564468)" pattern="-?\d+\.?\d*">
    <input type="date" id="date">
    <input type="text" id="note" placeholder="備註">
    <button onclick="addMarkerFromInput()">新增標註</button>
    <button onclick="clearAllMarkers()">清除所有標註</button>
</div>
    <div id="map"></div>
    <h3>已儲存點位清單</h3>
    <ul id="marker-list"></ul>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        let map;
        let markers = [];
        const STORAGE_KEY = 'saved_gps_points';

        // 初始化地圖
        function initMap() {
            map = L.map('map').setView([23.5, 121], 7); // 預設中心為台灣
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap 貢獻者'
            }).addTo(map);

            loadAndDisplayMarkers();
            updateMarkerList();
        }

        // 從localStorage載入點位
        function loadAndDisplayMarkers() {
    const savedData = localStorage.getItem(STORAGE_KEY);
    if (savedData) {
        JSON.parse(savedData).forEach(point => {
            addMarker(point.lat, point.lng, point.label, point.date, point.note);
        });
    }
}

        // 新增標記到地圖
        function addMarker(lat, lng, label = '未命名地點', date = '', note = '') {
    const popupContent = `
        <b>${label}</b><br>
        緯度: ${lat}<br>
        經度: ${lng}<br>
        日期: ${date}<br>
        備註: ${note}
    `;

    const marker = L.marker([lat, lng], {
        title: label,
        alt: `GPS點位 (${lat}, ${lng})`,
        riseOnHover: true
    }).addTo(map)
    .bindPopup(popupContent);

    markers.push({
        lat, lng, label, date, note, marker
    });
}

        // 從輸入框新增標記
       function addMarkerFromInput() {
    const latInput = document.getElementById('lat');
    const lngInput = document.getElementById('lng');
    const dateInput = document.getElementById('date');
    const noteInput = document.getElementById('note');

    const lat = parseFloat(latInput.value);
    const lng = parseFloat(lngInput.value);
    const date = dateInput.value;
    const note = noteInput.value.trim();

    if (isNaN(lat) || isNaN(lng)) {
        alert('請輸入有效的經緯度數值！');
        return;
    }

    const label = prompt('請輸入地點名稱：', '未命名地點');
    addMarker(lat, lng, label, date, note);
    saveMarkers();
    updateMarkerList();

    latInput.value = '';
    lngInput.value = '';
    dateInput.value = '';
    noteInput.value = '';
}

        // 儲存到localStorage
        function saveMarkers() {
    const dataToSave = markers.map(m => ({
        lat: m.lat,
        lng: m.lng,
        label: m.label,
        date: m.date,
        note: m.note
    }));
    localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
}

        // 更新點位清單
        function updateMarkerList() {
    const list = document.getElementById('marker-list');
    list.innerHTML = markers.map((m, i) => `
        <li>
            <b>${m.label}</b><br>
            緯度: ${m.lat.toFixed(6)}，經度: ${m.lng.toFixed(6)}<br>
            日期: ${m.date}<br>
            備註: ${m.note}<br>
            <button onclick="deleteMarker(${i})">刪除</button>
        </li>
    `).join('');
}

        // 刪除單個標記
        function deleteMarker(index) {
            markers[index].marker.remove();
            markers.splice(index, 1);
            saveMarkers();
            updateMarkerList();
        }

        // 清除所有標記
        function clearAllMarkers() {
            if (confirm('確定要清除所有標記嗎？')) {
                markers.forEach(m => m.marker.remove());
                markers = [];
                localStorage.removeItem(STORAGE_KEY);
                updateMarkerList();
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
